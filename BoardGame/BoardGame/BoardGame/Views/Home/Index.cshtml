@using WebMatrix.Data
@{
    var db = Database.Open("BoardGame");
    var search = Request.Form["searchText"];
    var viewMode = Request.Form["viewMode"] ?? "table";

    var sql = @"
SELECT b.BGGId, b.Name, b.Description, b.YearPublished,
c.Category, b.ImagePath 
FROM BoardGame b
LEFT JOIN GameCategory gc ON b.BGGId = gc.BGGId
LEFT JOIN Category c ON gc.Category = c.CategoryID"
;

    if (!String.IsNullOrEmpty(search))
    {
        sql += " WHERE b.Name LIKE @0";
        search += "%";
    }

    var data = String.IsNullOrEmpty(search) ? db.Query(sql) : db.Query(sql, search);
}


<form method="post" class="row mb-3 justify-content-end">
    <div class="col-3">
        <select name="viewMode" class="form-select" onchange="this.form.submit()">
            <option value="table" @(viewMode == "table" ? "selected" : "")>Table View</option>
            <option value="card" @(viewMode == "card" ? "selected" : "")>Card View</option>
        </select>
    </div>
    <div class="col-2">
        <input type="text" name="searchText"
               value="@Request.Form["searchText"]"
               placeholder="Search by game name..."
               class="form-control" />
    </div>
    <div class="col-2">
        <button type="submit" class="btn btn-primary w-100">Search</button>
    </div>
</form>


@if (data.Count() > 0)
{
    if (viewMode == "table")
    {
        <table class="table table-striped table-hover text-center align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Year Published</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var row in data)
                {
                    <tr>
                        <td>
                            <img src="@row.ImagePath" alt="@row.Name image"
                                 style="height:120px; object-fit:cover;" />
                        </td>
                        <td>@row.Name</td>
                        <td>@row.Category ?? "N/A"</td>
                        <td>@Convert.ToDateTime(row.YearPublished).ToString("yyyy")</td>
                        <td>
                            <a href="/Home/Details?id=@row.BGGId" class="btn btn-outline-primary">View Details</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="row justify-content-center">
            @foreach (var row in data)
            {
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card h-100 shadow-sm">
                        <img src="@row.ImagePath" class="card-img-top" alt="@row.Name image"
                             style="height:180px; object-fit:cover;">
                        <div class="card-body">
                            <h5 class="card-title">@row.Name</h5>
                            <p class="card-text">
                                <strong>Category:</strong> @(row.Category ?? "N/A")<br />
                                <strong>Year:</strong> @Convert.ToDateTime(row.YearPublished).ToString("yyyy")
                            </p>
                            <a href="/Home/Details?id=@row.BGGId" class="btn btn-outline-primary btn-sm">View Details</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
}
else
{
    <p class="text-center text-muted">No board games found</p>
}

